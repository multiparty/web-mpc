<html>
<head>
	<title>Trusted Party Live Session Tracker</title>

	<script type="text/javascript" src="../shared/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="../shared/underscore.js"></script>
	<script type="text/javascript" src="script/generateSession.js"></script>
  <link rel="stylesheet" type="text/css" href="style/bootstrap/css/bootstrap.css">
  <style>
    #table {
      visibility: hidden;
    }
    #statusID {
      visibility: hidden;
    }
    #urlsSection {
      visibility: hidden;
    }
    #urlsID {
      visibility: hidden;
    }
    input[type=text] {
      height: 30px;
      width: 300px;
    }
    input[type=password] {
      height: 30px;
      width: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="page-header">
      <table width="100%">
        <tr>
          <td>
            <h1>Trusted Party<br/><small>Live Session Tracker</small></h1>
          </td>
          <td align="right">
            <img src="../shared/bu.png" width="110px"/>
          </td>
        </tr>
      </table>
    </div>
    <form class="form-inline" role="form" id="inputform">
      <input type="text" id="sess" placeholder="Session Number"/>
      <input type="password" id="pass" placeholder="Session Password"/>
      <button id="submit" type="button" class="btn btn-primary" onclick="genT()">SUBMIT</button>
    </form>
    <div class="alert alert-success" id="statusID">LOADING...</div>

    <h3>Tracking and Unmasking</h3>
    <div><a id="unmasklink"></a></div>
    <table class="table table-striped" id="table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Posted</th>
        </tr>
      </thead>
      <tbody id="participants">
      </tbody>
    </table>
    <br />
    <div id="urlsSection">
      <h3>Links for Participants </h3>
      <form class="form-inline" role="form">
        <input autocomplete="off" type="text" id="countID" placeholder="Enter Number of new links needed" pattern="^[0-9]{1,5}$" size="5" required>
        <button id="gen_button" type="button" class="btn" id="Generate">
          Generate Links
        </button>
      </form>
      <pre id="urlsID"></pre>

      <div id="oldUrlsSection">
        <h3>Previously Generated Links</h3>
        <pre id="oldUrlsID"></pre>
      </div>
    </div>
    <script>
      window.genT = function() {
        document.getElementById('table').style.visibility = "visible";
        document.getElementById('statusID').style.visibility = "visible";
        document.getElementById('urlsSection').style.visibility = "visible";

        var session = document.getElementById('sess').value;
        var password = document.getElementById('pass').value;
        $('#inputform').remove();

        document.getElementById('unmasklink').innerHTML = "Click here to unmask aggregate data Session " + session;
        document.getElementById('unmasklink').href = "../unmask/index.html?session=" + session;

        generateTable('table', session, password, 'statusID');
        fetchOldLinks(session, password, "oldUrlsID", "oldUrlsSection");
        document.getElementById("gen_button").onclick = function() { generateUrls(session, password, 'urlsID', 'countID') };
      }
      window.getParameterByName = function(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }
      if(getParameterByName('session')) {
        var session = getParameterByName('session');
        document.getElementById("sess").value = session;
      }
    </script>
  </div>
</body>
</html>
