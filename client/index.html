<!doctype html>
<html>
<head>
  <title>Financial Services D&amp;I Scorecard</title>

  <script type="text/javascript" src="../shared/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="../shared/underscore.js"></script>
  <script type="text/javascript" src="../shared/handsontable-pro/dist/handsontable.full.js"></script>
  <script type="text/javascript" src="../shared/forge.min.js"></script>
  <script type="text/javascript" src="../shared/mpc.js"></script>
  <script type="text/javascript" src="style/bootstrap/js/bootstrap.js"></script>
  <script type="text/javascript" src="style/alertify/alertify.js"></script>
  <script type="text/javascript" src="style/alertify/alertify-defaults.js"></script>
  <script type="text/javascript" src="script/spin.min.js"></script>
  <script type="text/javascript" src="script/ladda.min.js"></script>
  <script type="text/javascript" src="../shared/sail_hot.js"></script>
  <script type="text/javascript" src="script/client.js"></script>

  <link rel="stylesheet" type="text/css" href="style/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="style/bootstrap/v3/css/bootstrap-theme.min.css">
  <link rel="stylesheet" type="text/css" href="../shared/handsontable-pro/dist/handsontable.full.css">
  <link rel="stylesheet" type="text/css" href="style/alertify/css/alertify.css">
  <link rel="stylesheet" type="text/css" href="style/alertify/css/themes/alertify-bootstrap.css">
  <link rel="stylesheet" href="style/ladda-themeless.min.css">

  <style type="text/css">
    .handsontable .ht_clone_top,
    .handsontable .ht_clone_top_left,
    .handsontable .ht_clone_top_left_corner {
      display: none;
    }
    .handsontable col.rowHeader {
      width: 200px !important;
    }
    #body_wrap {
      padding-left: 8%;
      padding-right: 8%;
      padding-bottom: 50px;
    }
    #body_wrap input {
      margin-bottom: 0px;
    }
    #submit {
      float: left;
      text-align:right;
    }

    #sess {
      width:25em;
    }

    .handsontable th:first-child {
      text-align: left;
      white-space: normal;
    }
    .handsontable th {
      font-size:12px;
      white-space: pre-line;
      max-width: 110px;
      vertical-align: middle;
    }
    .page-footer {
      padding-top: 50px;
    }

    /* for alerts and submission history*/
    .ajs-header img {
      padding-right: 0.5em;
    }

    .success img {
      padding-right: 0.5em;
    }

    .error img {
      padding-right: 0.5em;
    }

    p {
      font-weight: 400 !important;
      font-size: 1rem !important;
      color: #444;
    }
    form label {
      font-weight: 400 !important;
      font-size: 1rem !important;
      color: #444;
    }

    input:invalid {
      border: 1px solid red;
    }

    input:valid {
      border: 1px solid green;
    }
  </style>
</head>
<body>
  <div id="body_wrap">
  <div class="page-header">
    <table width="100%">
    <tr>
      <td>
      <h1>Financial Services D&amp;I Scorecard<br/><small>DRAFT</small></h1>
      </td>
      <td align="right">
      <img src="../shared/bu.png" width="110px"/>
      </td>
    </tr>
    </table>
  </div>
  <div>
    <h3>Enter Session Key</h3>
    <input autocomplete="off" type="text" id="sess" pattern="^[a-z0-9]{32}$" size="32" required/>
  </div>

  <h3 id="number-employees-hot-name"></h3>
  <div id="number-employees-hot"></div>
  <h3 id="compensation-hot-name"></h3>
  <div id="compensation-hot"></div>
  <h3 id="performance-pay-hot-name"></h3>
  <div id="performance-pay-hot"></div>
  <h3 id="service-length-hot-name"></h3>
  <div id="service-length-hot"></div>
  <h3 id="totals-hot-name"></h3>
  <div id="totals-hot"></div>

  <div id="additional-questions">
    <h3>Additional Questions</h3>
    <div id="questions">
      <form>
        <p class="question-text">Does your company hold events to celebrate diversity and inclusion?</p>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="Yes">Yes</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="No">No</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="NA" checked="checked">Do not wish to answer</label>
        </div>
      </form>
      <form>
        <p class="question-text">Does your company provide diversity and inclusion education or training for managers, staff or both?</p>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="Yes">Yes</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="No">No</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="NA" checked="checked">Do not wish to answer</label>
        </div>
      </form>
      <form>
        <p class="question-text">Does your management team meet to discuss your organization's diverse workforce or workplace culture?</p>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="Yes">Yes</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="No">No</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="NA" checked="checked">Do not wish to answer</label>
        </div>
      </form>
      <form>
        <p class="question-text">Does your CEO engage in or lead discussions on diversity and inclusion with your management team or with other business executives?</p>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="Yes">Yes</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="No">No</label>
        </div>
        <div class="radio">
          <label><input autocomplete="off" type="radio" name="optradio" value="NA" checked="checked">Do not wish to answer</label>
        </div>
      </form>
    </div>
  </div>
  <div>
    <form>
      <div class="checkbox">
      <label>
        <input autocomplete="off" type="checkbox" id="verify" name="verify"> All information is verified and correct
      </label>
      </div>
    </form>
  </div>
  <button name="dump" id="submit" class="btn btn-primary ladda-button" data-style="zoom-out">
    <span class="ladda-label">Submit</span>
  </button>
    <div class="page-footer">

    </div>
  <br/>
  <script type="text/javascript">
    $(document).ready(function() {

      //Copied from trusted/session_data
      window.getParameterByName = function(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      var userkey = getParameterByName('userkey');
      $('#sess').val(getParameterByName('sessionkey'));

      var req = $.ajax({
        type: "GET",
        url: "../shared/templates/tables.json",
        dataType: "json"
      }).then(function (tables_def) {
        // Create the tables
        var tables = make_tables(tables_def); window.scrollTo(0, 0);
        var sums = [0, 0, 0, 0, 0, 0];

        // Custom validator that computes the totals
        var afterChange = function(table) {
          var index_map = {
            "Number Of Employees": 0,
            "Total Annual Compensation (Dollars)": 1,
            "Total Annual Cash Performance Pay (Dollars)": 1,
            "Total Length of Service (Months)": 2
          }

          var table_index = index_map[table._sail_meta.name];
          var totals_table = tables[tables.length-1];
          return function(changes, source) {
            if(changes == null) return;
            for(var i = 0; i < changes.length; i++) {
              var change = changes[i];
              var old = change[2]; var val = change[3];

              old = (old == '' || old == null) ? 0 : old;
              val = (val == '' || val == null) ? 0 : val;
              if(old == val) continue;

              var c = change[1];
              var index = 2*table_index + (c % 2);
              sums[index] += val - old;
            }

            totals_table.loadData([sums, sums]);
          }
        }

        // Register when ready
        for(var i = 0; i < tables.length-1; i++)
          tables[i].addHook('afterChange', afterChange(tables[i]));

        // Button clicks handlers
        $('#verify').click(function() {
          validate(tables, function(result, msg) {
            if(result)
              return $("#submit").prop('disabled', false);

            error(msg);
            $('#verify').prop('checked', false);
          });
        });

        $("#submit").click(function() {
          var la = Ladda.create(document.getElementById('submit'));
          validate(tables, function(result, msg) {
            if(!result) {
              la.stop();
              error(msg);
              return;
            }

            construct_and_send(tables, la, userkey);
          });
        });

      });
    });
  </script>
  </div>
</body>
</html>
